<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üöÄ Code Error Finder - VSCode Style</title>

<!-- Monaco Editor CDN -->
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs/loader.js"></script>

<style>
  body, html { margin:0; padding:0; height:100%; font-family:"Fira Code", monospace; overflow:hidden; background:#1e1e2f; color:#f8fafc; }
  header, footer { text-align:center; font-weight:bold; padding:12px 0; color:#fff; background:#3b82f6; }
  header { font-size:1.5rem; } footer { font-size:0.9rem; }
  .container { display:flex; height:calc(100vh - 84px); overflow:hidden; }
  /* Editor Panel */
  .editor-panel { flex:2; display:flex; flex-direction:column; min-width:400px; }
  .editor-top-bar { display:flex; align-items:center; gap:10px; padding:6px; background:#1f2937; }
  .editor-top-bar select, .editor-top-bar button { padding:6px 12px; font-size:14px; border:none; border-radius:4px; cursor:pointer; }
  .editor-top-bar select { background:#3b3a55; color:#fff; }
  .editor-top-bar button { background:#3b82f6; color:#fff; transition:0.2s; }
  .editor-top-bar button:hover { background:#2563eb; }
  #lang-logo { width:22px; height:22px; }
  #editor-container { flex:1; }
  /* Splitter */
  #splitter { width:5px; cursor:col-resize; background:#3b3a55; transition:0.2s; }
  #splitter:hover { background:#60a5fa; }
  /* Output Panel */
  .output-panel { flex:1; display:flex; flex-direction:column; min-width:250px; background:#252637; border-left:1px solid #3b3a55; }
  .output-top-bar { display:flex; align-items:center; gap:10px; padding:6px; background:#1f2937; }
  .output-top-bar button { padding:6px 12px; font-size:14px; border:none; border-radius:4px; cursor:pointer; background:#3b82f6; color:#fff; transition:0.2s; }
  .output-top-bar button:hover { background:#2563eb; }
  #output-title { font-weight:bold; margin-left:10px; margin-bottom:5px; color:#60a5fa; }
  #output { flex:1; background:#1e1e2f; border-radius:6px; padding:10px; overflow-y:auto; white-space:pre-wrap; font-size:14px; line-height:1.4; margin:0 10px 10px 10px; }
</style>
</head>
<body>

<header>üöÄ Code Error Finder</header>

<div class="container">
  <!-- Editor Panel -->
  <div class="editor-panel">
    <div class="editor-top-bar">
      <img id="lang-logo" src="" alt="">
      <select id="language">
        <option value="python">Python</option>
        <option value="java">Java</option>
        <option value="cpp">C++</option>
        <option value="c">C</option>
        <option value="js">JavaScript</option>
        <option value="html">HTML</option>
      </select>
      <button id="clearCodeBtn">Clear Code</button>
      <button id="downloadCodeBtn">Download Code</button>
      <button id="themeToggle">üåô Dark/Light</button>
    </div>
    <div id="editor-container"></div>
  </div>

  <!-- Splitter -->
  <div id="splitter"></div>

  <!-- Output Panel -->
  <div class="output-panel">
    <div class="output-top-bar">
      <button id="runBtn">Run Code</button>
      <button id="clearOutputBtn">Clear Output</button>
      <button id="downloadOutputBtn">Download Output</button>
    </div>
    <div id="output-title">Output:</div>
    <div id="output">üìù Your output will appear here...</div>
  </div>
</div>

<footer>&copy; 2025 ML-Powered Error Finder</footer>

<script>
const BACKEND_URL = "https://errorfinder.onrender.com/analyze";

// Monaco Editor setup
require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs' }});
require(['vs/editor/editor.main'], function() {
  window.editor = monaco.editor.create(document.getElementById('editor-container'), {
    value: "# Write your code here\n",
    language: "python",
    theme: "vs-dark",
    fontSize:14,
    automaticLayout:true,
    minimap:{enabled:false}
  });
  updateLanguageLogo("python");
});

// Language select
const languageSelect = document.getElementById("language");
const langLogo = document.getElementById("lang-logo");

function updateLanguageLogo(lang){
  const logos = {
    python:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/python/python-original.svg",
    java:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/java/java-original.svg",
    cpp:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/cplusplus/cplusplus-original.svg",
    c:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/c/c-original.svg",
    js:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/javascript/javascript-original.svg",
    html:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/html5/html5-original.svg"
  };
  langLogo.src = logos[lang] || "";
}

languageSelect.addEventListener("change",()=>{
  let lang = languageSelect.value;
  updateLanguageLogo(lang);
  let monacoLang = lang==="js"?"javascript":lang;
  monaco.editor.setModelLanguage(editor.getModel(),monacoLang);
});

// Dark/Light toggle
const themeToggle = document.getElementById("themeToggle");
let isDark = true;
themeToggle.addEventListener("click",()=>{
  isDark=!isDark;
  monaco.editor.setTheme(isDark?"vs-dark":"vs-light");
});

// Buttons
const runBtn = document.getElementById("runBtn");
const clearCodeBtn = document.getElementById("clearCodeBtn");
const clearOutputBtn = document.getElementById("clearOutputBtn");
const downloadCodeBtn = document.getElementById("downloadCodeBtn");
const downloadOutputBtn = document.getElementById("downloadOutputBtn");
const outputDiv = document.getElementById("output");

clearCodeBtn.addEventListener("click",()=>{ editor.setValue(""); });
clearOutputBtn.addEventListener("click",()=>{ outputDiv.textContent="üìù Your output will appear here..."; });
downloadCodeBtn.addEventListener("click",()=>{ downloadFile("code.txt",editor.getValue()); });
downloadOutputBtn.addEventListener("click",()=>{ downloadFile("output.txt",outputDiv.textContent); });

function downloadFile(filename, content){
  const blob = new Blob([content], {type:"text/plain"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
}

// Run code
runBtn.addEventListener("click", async()=>{
  const code = editor.getValue();
  const language = languageSelect.value;
  if(!code.trim()){ outputDiv.textContent="‚ö† Please write some code!"; return; }
  outputDiv.textContent="üîÑ Running your code...";

  try{
    const res = await fetch(BACKEND_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({code,language})
    });
    const data = await res.json();
    let resultText = "";
    if(data.output) resultText += `üåê Language: ${language.toUpperCase()}\n\nüíª Output:\n${data.output}\n\n`;
    if(data.error) resultText += `üî¥ Errors:\n${data.error}\n\n`;
    if(language==="html" && !data.error) resultText += "\nüìÑ Live Preview Below:\n";
    if(!data.output && !data.error) resultText="‚úÖ Execution finished (no output).";
    outputDiv.textContent=resultText;

    // HTML/JS live preview
    if(language==="html" || language==="js"){
      let previewWindow = document.getElementById("htmlPreview");
      if(!previewWindow){
        previewWindow=document.createElement("iframe");
        previewWindow.id="htmlPreview";
        previewWindow.style.height="200px";
        previewWindow.style.width="100%";
        outputDiv.appendChild(previewWindow);
      }
      previewWindow.style.display="block";
      if(language==="html") previewWindow.srcdoc=code;
      if(language==="js") previewWindow.srcdoc=`<script>${code}<\/script>`;
      if(language==="html+js") previewWindow.srcdoc=code;
    }

  }catch(err){
    outputDiv.textContent=`‚ùå Connection Error:\n${err.message}`;
  }
});

// Adjustable Splitter
const splitter = document.getElementById("splitter");
const editorPanel = document.querySelector(".editor-panel");
const outputPanel = document.querySelector(".output-panel");
let isDragging=false;

splitter.addEventListener("mousedown",()=>{ isDragging=true; });
document.addEventListener("mouseup",()=>{ isDragging=false; });
document.addEventListener("mousemove",(e)=>{
  if(!isDragging) return;
  const containerWidth = editorPanel.parentElement.offsetWidth;
  const splitterWidth = splitter.offsetWidth;
  let editorWidth = e.clientX;
  const minEditor=400, minOutput=250;
  if(editorWidth<minEditor) editorWidth=minEditor;
  if(editorWidth>containerWidth-minOutput-splitterWidth) editorWidth=containerWidth-minOutput-splitterWidth;
  editorPanel.style.flex=`0 0 ${editorWidth}px`;
  outputPanel.style.flex=`0 0 ${containerWidth-editorWidth-splitterWidth}px`;
  editor.layout();
});
window.addEventListener("resize",()=>{ editor.layout(); });

</script>
</body>
</html>
