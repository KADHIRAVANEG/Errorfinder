<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸš€ Code Error Finder</title>
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs/loader.js"></script>
<style>
:root {
  --bg: #1e1e2f;
  --text: #f8fafc;
  --accent: #4f8ef7;
  --border: #3b3a55;
  --panel: #252637;
  --button-gray: #6b7280;
}
[data-theme="light"] {
  --bg: #e0e0e0;
  --text: #333333;
  --accent: #2c6eb8;
  --border: #bebebe;
  --panel: #f0f0f0;
  --button-gray: #b5b5b5;

}

body {
  margin:0;
  font-family:"Fira Code",monospace;
  background: var(--bg);
  color: var(--text);
  height:100vh;
  display:flex;
  flex-direction:column;
}
header, footer {
  background: var(--accent);
  color:white;
  text-align:center;
  padding:12px 0;
  font-weight:bold;
}
.container{
  display:flex;
  flex:1;
  overflow:hidden;
  min-height:0;
}
#left-pane{
  flex:2;
  display:flex;
  flex-direction:column;
  min-width:0;
  min-height:0;
}
#editor-logo-container {
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  background: var(--panel);
  border-bottom:1px solid var(--border);
}
#editor-logo-container img {
  width:24px;
  height:24px;
}
#editor-logo-container span {
  font-weight:bold;
  font-size:1rem;
}
#editor-container{
  flex:1;
  min-width:0;
  min-height:0;
}
#splitter{
  width:5px;
  background:var(--border);
  cursor:col-resize;
  user-select:none;
}
#output-container{
  flex:1;
  display:flex;
  flex-direction:column;
  border-left:1px solid var(--border);
  min-width:0;
  min-height:0;
  background: var(--panel);
}
.top-bar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:8px 12px;
  gap:8px;
  background: var(--bg);
}
select{
  border-radius:4px;
  padding:4px 6px;
  font-size:14px;
  cursor:pointer;
}
button{
  border:none;
  border-radius:4px;
  padding:6px 12px;
  font-size:14px;
  cursor:pointer;
  transition:0.15s;
  background: var(--button-gray);
  color:white;
}
#runBtn{
  background: var(--accent);
}
button:hover{opacity:0.9;}
#output-title{
  padding:8px 12px;
  font-weight:bold;
  color: var(--accent);
}
#output, iframe{
  flex:1;
  background: var(--bg);
  color: var(--text);
  padding:12px;
  margin:0 10px 10px 10px;
  border-radius:8px;
  overflow-y:auto;
  white-space:pre-wrap;
  min-height:0;
}
iframe{display:none;width:100%;height:100%;border:none;background:white;}
.toggle{
  background: var(--button-gray);
  color: var(--text);
}
.logo-img{
  width:20px;
  height:20px;
}
.logo{
  font-size:1.1rem;
  font-weight:bold;
}
</style>
</head>
<body data-theme="dark">
<header>ðŸš€ Code Error Finder</header>

<div class="container">
  <div id="left-pane">
    <div class="top-bar">
      <div>
        <select id="language">
          <option value="python">Python</option>
          <option value="java">Java</option>
          <option value="cpp">C++</option>
          <option value="c">C</option>
          <option value="html">HTML</option>
          <option value="js">JavaScript</option>
          <option value="htmljs">HTML + JS</option>
        </select>
      </div>
      <div>
        <button id="clearCodeBtn">Clear Code</button>
        <button id="downloadBtn">Download</button>
        <button class="toggle" id="themeToggle">ðŸŒ™ Dark</button>
      </div>
    </div>

    <!-- Editor Logo Container -->
    <div id="editor-logo-container">
      <img id="editorLogoImg" src="" alt="logo">
      <span id="editorLogoText">Python Mode</span>
    </div>

    <div id="editor-container"></div>
  </div>

  <div id="splitter" title="Drag to resize"></div>

  <div id="output-container">
    <div class="top-bar">
      <div id="output-title">
        Output Panel
      </div>
      <div>
        <button id="copyOutputBtn">Copy</button>
        <button id="runBtn">Run</button>
        <button id="clearOutputBtn">Clear Output</button>
      </div>
    </div>
    <div id="output">Your output will appear here...</div>
    <iframe id="livePreview" sandbox="allow-scripts allow-same-origin"></iframe>
  </div>
</div>

<footer>&copy; 2025 ML-Powered Error Finder</footer>

<script>
const BACKEND_URL = "https://errorfinder.onrender.com/analyze";
const outputDiv = document.getElementById("output");
const livePreview = document.getElementById("livePreview");
const themeToggle = document.getElementById("themeToggle");
const languageSelect = document.getElementById("language");
const editorLogoImg = document.getElementById("editorLogoImg");
const editorLogoText = document.getElementById("editorLogoText");
const leftPane = document.getElementById("left-pane");
const outputContainer = document.getElementById("output-container");

const extMap={python:"py",java:"java",cpp:"cpp",c:"c",html:"html",js:"js",htmljs:"html"};
const logoMap={
  python:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/python/python-original.svg",
  java:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/java/java-original.svg",
  cpp:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/cplusplus/cplusplus-original.svg",
  c:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/c/c-original.svg",
  html:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/html5/html5-original.svg",
  js:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/javascript/javascript-original.svg",
  htmljs:"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/html5/html5-original.svg"
};

let currentTheme="vs-dark";
require.config({paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs"}});
require(["vs/editor/editor.main"], function(){
  window.editor=monaco.editor.create(document.getElementById("editor-container"),{
    value:"# Write your code here...",
    language:"python",
    theme:currentTheme,
    automaticLayout:true,
    fontSize:14,
    minimap:{enabled:false}
  });
  initUI();
});

function initUI(){
  updateLogo(languageSelect.value);

  themeToggle.addEventListener("click", ()=>{
    const body=document.body;
    const isDark=body.getAttribute("data-theme")==="dark";
    body.setAttribute("data-theme",isDark?"light":"dark");
    currentTheme=isDark?"vs":"vs-dark";
    monaco.editor.setTheme(currentTheme);
    themeToggle.innerHTML=isDark?"ðŸŒž Light":"ðŸŒ™ Dark";
    editor.layout();
  });

  languageSelect.addEventListener("change", ()=>{
    const lang=languageSelect.value;
    const langMap={python:"python",java:"java",cpp:"cpp",c:"c",js:"javascript",html:"html",htmljs:"html"};
    monaco.editor.setModelLanguage(editor.getModel(),langMap[lang]);
    editorLogoText.innerText = `${lang.toUpperCase()} Mode`;
    updateLogo(lang);
  });

  function updateLogo(lang){
    const url = logoMap[lang] || "";
    editorLogoImg.src = url;
  }

  document.getElementById("runBtn").onclick=async()=>{
    const code=editor.getValue();
    const language=languageSelect.value;
    outputDiv.style.display="block";
    livePreview.style.display="none";

    if(!code.trim()){ outputDiv.textContent="âš  Please write some code!"; return; }

    if(language==="html"||language==="js"||language==="htmljs"){
      livePreview.style.display="block";
      livePreview.srcdoc=code;
      outputDiv.textContent="ðŸŒ Live Preview Loaded!";
      return;
    }

    outputDiv.textContent="ðŸ”„ Running your code...";
    try{
      const res=await fetch(BACKEND_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({code,language})
      });
      const data=await res.json();
      let resultText="";
      if(data.output) resultText+=`Output:\n${data.output}\n\n`;
      if(data.error) resultText+=`Errors:\n${data.error}\n\n`;
      if(!data.output&&!data.error) resultText="âœ… Execution finished (no output).";
      outputDiv.textContent=resultText;
    }catch(err){ outputDiv.textContent=`âŒ Connection Error:\n${err.message}`;}
  };

  document.getElementById("clearCodeBtn").onclick=()=>{ editor.setValue(""); };
  document.getElementById("clearOutputBtn").onclick=()=>{ outputDiv.textContent="Your output will appear here..."; livePreview.style.display="none"; };
  document.getElementById("downloadBtn").onclick=()=>{
    const blob=new Blob([editor.getValue()],{type:"text/plain"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download=`code.${extMap[languageSelect.value]}`;
    a.click();
    a.remove();
  };
  document.getElementById("copyOutputBtn").onclick=async()=>{
    try{ await navigator.clipboard.writeText(outputDiv.textContent||""); alert("Output copied!"); }catch(e){ alert("Copy failed"); }
  };
}

// Splitter logic
(function(){
  const splitter=document.getElementById("splitter");
  let isDragging=false;
  function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
  splitter.addEventListener("mousedown",(e)=>{ isDragging=true; document.body.style.userSelect="none"; document.body.style.cursor="col-resize"; });
  document.addEventListener("mousemove",(e)=>{
    if(!isDragging) return;
    const rect=document.querySelector(".container").getBoundingClientRect();
    const totalWidth=rect.width||window.innerWidth;
    const percent=clamp((e.clientX-rect.left)/totalWidth*100,20,80);
    leftPane.style.flex=(percent/50).toString();
    outputContainer.style.flex=(2-percent/50).toString();
    editor.layout();
  });
  document.addEventListener("mouseup",()=>{ if(isDragging){ isDragging=false; document.body.style.userSelect=""; document.body.style.cursor=""; editor.layout(); }});
})();
</script>
</body>
</html>
